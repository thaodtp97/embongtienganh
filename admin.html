<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Admin Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <style>
    body{font-family:sans-serif;background:#f5f5f5;padding:2rem;}
    h1{text-align:center;}
    #mistakeChart{max-width:720px;margin:2rem auto;}
  </style>
</head>
<body>
  <h1>Dashboard Lỗi Sai Top</h1>
  <canvas id="mistakeChart"></canvas>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyDFAu80468VblytwF2UmKXGRAhRM5odGG8",
      authDomain: "embongtienganh.firebaseapp.com",
      projectId: "embongtienganh",
      storageBucket: "embongtienganh.firebasestorage.app",
      messagingSenderId: "616191414364",
      appId: "1:616191414364:web:91a358db8a8a04f69f5699",
      measurementId: "G-X9KNG69VPN"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    db.collection('sessions').get().then(sn => {
      const counts = {};
      sn.forEach(doc => {
        const { mistakes=[] } = doc.data();
        mistakes.forEach(w => counts[w] = (counts[w]||0) + 1);
      });
      const entries = Object.entries(counts)
                            .sort((a,b)=>b[1]-a[1])
                            .slice(0,10);
      const labels = entries.map(e=>e[0]), data=entries.map(e=>e[1]);

      new Chart(document.getElementById('mistakeChart'), {
        type:'bar',
        data:{ labels, datasets:[{ label:'Số lỗi sai', data, backgroundColor:'#f44336' }]},
        options:{ scales:{ y:{ beginAtZero:true }}}
      });
    }).catch(console.error);
  </script>
</body>
</html>
